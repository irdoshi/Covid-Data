---
title: "Assignment 2"
author: "Isha Doshi"
date: "2022-10-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## 1 COVID-19 Data
**1.1 Load a single month of African data**

**1. Load the list of African countries countries-africa.csv. How many African countries are listed here?**

Answer: There are 58 countries listed here.
```{r}
Africa <- read.delim("covid/countries-africa.csv.bz2")
head(Africa,5)
nrow(Africa)
any(is.na(Africa$country)) 
# checking if any country is NA. There are 58 African countries listed in the database.
```

**2. Collect all the names of covid data files covid-global... into a character vector. How many files are there?**
Hint: check out the function list.files, and its argument pattern.

Answer: There are 21 files with names starting with covid data.

```{r}
vec= list.files(path = "covid/", pattern = "^covid-global", all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)
vec
#list.files produces a character vector so we can find the length directly.
length(vec)
```

**3. Load the COVID data file for October 2021. Ensure you know the variables there.
But the global data file contains not just African countries, so you have just to select the African ones from the list. Unfortunately not all the names match.**

```{r}
library(tidyverse)
library (dplyr)
october2021= read.delim("covid/covid-global_10-01-2021.csv.bz2")
head(october2021)
# checking the names of the columns in Oct 2021 data
names(october2021)
```

**4. How many African countries in the African Country list do you find in the covid data? Do not attempt to adjust the names for now.**

Answer: 49 countries can be found in Oct 2021 covid data from African countries list
```{r}
library(tidyverse)
library (dplyr)
# filtering oct data based on African countries 

AfricaOct2021<- october2021[october2021$Country_Region %in% Africa$country,]

# tried two methods 

AfricaOct2021 <- filter(october2021,october2021$Country_Region %in% Africa$country)
head(AfricaOct2021)

nrow(AfricaOct2021)

```
**5. Which African countries are not matched in the COVID data? Again, do not adjust the names for now.**

Answer: The 9 countries below are not matched in covid data. 
```{r}
`%notin%` <- Negate(`%in%`)
MissingAfricanCountries <- filter(Africa,Africa$country %notin% october2021$Country_Region)
MissingAfricanCountries
```

**6. Why should we care more about these three countries and less about other entities?**

Answer: We should care more about these countries as their population is higher than the smaller islands. If these countries are ignored, the number of cases and deaths due to covid in Africa could be miscalculated entirely. The data we would be using further would not stay accurate.

**7. Next, find how are the names of these three countries (Two Congos and Ivory Coast) written in the covid data.**

Answer: after looking through the Oct 2021 data's list of countries, I found that these 3 countries are written as Congo (Kinshasa), Congo (Brazzaville) and Cote d’Ivoire.

```{r}
names<-october2021 %>% filter(str_detect(october2021$Country_Region, "^Congo|^Cote"))
names
```

**8. Amend the list of African countries in a way that you can extract all the necessary African countries (you may leave out the islands/territories) from COVID data. Demonstrate that it works.**

Answer: I replaced Ivory Coast in the list of African countries with Cote d'Ivoire, Democratic Republic of the Congo with Congo (Kinshasa) and Republic of the Congo with Congo (Brazzaville).
```{r}
Africa$country[Africa$country =='Ivory Coast']<-"Cote d'Ivoire"
Africa$country[Africa$country=='Democratic Republic of the Congo']<-"Congo (Kinshasa)"
Africa$country[Africa$country=='Republic of the Congo']<-"Congo (Brazzaville)"
head(Africa)

# I am only left with “Réunion (France)”, “Western Sahara”, “Cape Verde”, “Mayotte (France)”, “São Tomé and Príncipe”, and “Saint Helena, Ascension and Tristan da Cunha (UK)”.

`%notin%` <- Negate(`%in%`)
MissingAfricanCountries <- filter(Africa,Africa$country %notin% october2021$Country_Region)
MissingAfricanCountries
```
## 1.2 Load and merge all datasets

**1. The file name is written as “covid-global_<mm>-<date>-<yyyy>.csv.bz2”, and date always “01” in these files. Extract the date part from the first file name as Date object.**

Answer: Removing the date part of file "covid-global_01-01-2021.csv.bz2" and storing it in a object of date type. 
```{r}
filename="covid-global_01-01-2021.csv.bz2"
filename=gsub("^[^_]*_","", filename)
filename=gsub("\\..*","",filename)
filename
firstDate= as.Date(filename, "%m-%d-%Y")
firstDate
class(firstDate)
```

**2. Now it is time to merge all the data files into one.** 

```{r}
library(tidyverse)
library(lubridate)
#creating a merged df by binding data from each file after performing processes to extract date, select and rename columns, and selecting African countries
mergedDf<-NULL
for (item in vec){
  df=read.delim(item)
 item=gsub("^[^_]*_","", item)
 item=gsub("\\..*","",item)
 firstDate= as.Date(item, "%m-%d-%Y")
  df$year=year(firstDate)
  df$month=month(firstDate)
  selectedDf=df%>%select(starts_with("Country"),Deaths, year, month)
  selectedDf=selectedDf%>%rename(country=starts_with("Country"))
  mergedDf=rbind(mergedDf,selectedDf)
}
mergedDf<- mergedDf[mergedDf$country %in% Africa$country,]
head(mergedDf)
nrow(mergedDf)
```
## 1.3 Display time series

**1. Extract the population size from the dataset of African countries. Ensure the result is a valid number, you need to do some math with it next.**

```{r}
AfricaPopulationDf= Africa%>%select(country,population)
head(AfricaPopulationDf)
```

**2. For each country, compute the death rate: number of deaths per 1M population. Note: you have to merge the population data with the covid death data you compiled above.**

```{r}
#Merging AfricanPopulationDf with Africa's covid data
combinedDf=merge(mergedDf,AfricaPopulationDf,by.x="country", by.y="country", all=TRUE)
combinedDf$population <- as.numeric(gsub(",","",combinedDf$population))
combinedDf$deathRate<-(combinedDf$Deaths*100000)/as.numeric(combinedDf$population)
head(combinedDf)
```

**3. Which 10 countries have the largest death rate? (As of the latest date in the data, Oct 1st, 2021).**

Answer: Based on latest data (oct 2021), these are the 10 countries with largest death rate:
```{r}
topTen=combinedDf[order(combinedDf$deathRate, decreasing = TRUE), ]
topTen=topTen%>%filter(topTen$year=="2021" & topTen$month=="10")
head(topTen,10)
topTenCountries=head(topTen$country,10)
topTenCountries
```

**4. Make a plot where you show how the death rate has grown in these 10 countries over time. Ensure the plot is appropriately labelled and uses appropriate plot type, colors, and other visual details. **

```{r}
dfToVisualize= combinedDf[combinedDf$country %in% topTenCountries,]
dfToVisualize=within(dfToVisualize, Date <- sprintf("%d-%02d", year, month))
head(dfToVisualize)
ggplot(dfToVisualize, aes(x=Date, y=deathRate, fill=country, group=country)) + geom_point(aes(color = country)) +geom_line(aes(color=country))
```

**5. Let us also look at the number of monthly deaths: how much has the death rate grown from one month to another in these 10 countries? Compute the number of new monthly deaths (per 1M population) and display on a similar plot. Hint: check out the lag operator for mutate.**

```{r}
#correcting the order of data for using lag 
dfToVisualize=dfToVisualize[order(dfToVisualize$country, dfToVisualize$Date),]
#calculating the difference in the deaths per month, grouped by country
dfToVisualize$monthly_Deaths <- ave(dfToVisualize$Deaths, factor(dfToVisualize$country), FUN=function(x) c(NA,diff(x)))
head(dfToVisualize)
# now that we have monthly deaths, we can calculate monthly death rate and append that column to the df.
dfToVisualize$monthlyDeathRate=dfToVisualize$monthly_Deaths*100000/dfToVisualize$population
head(dfToVisualize)
# now we display this data 
ggplot(dfToVisualize, aes(x=Date, y=monthlyDeathRate, fill=country, group=country)) + geom_point(aes(color = country)) +geom_line(aes(color=country))
```

**6. Which country out of these 10 experienced the highest peak in the new monthly deaths? When was that? How many COVID “waves” can you see on the plot?**

Answer: Seychelles experienced the highest peak in the new monthly deaths. It was in 2020-08 (Aug-2020). I can see three waves in the graph.

## 1.4 Think about this

**Now when you have done all this analysis, imagine you are hired as a consultant for the John Hopkins Covid data project.**

**1.Where would the US be on the top-10 list of African countries?**

Answer: US will be on the top of the list according to https://coronavirus.jhu.edu/data/mortality

**2. What do you think about reliability of these data? Hint: you can consult wikipedia or google for COVID death data reliability** 

Answer: These death reports are based on death certificates, but the reliability of this data can be questionable since a lot of 3rd world countries might not be reporting or tracking deaths caused by covid due to inadequate/limited resources. Countries might also use different processes to test and report COVID-19 deaths, making comparisons between countries difficult. 

**3. What recommendations would you give for the data collection team regarding to how collect/store data? Think about variable names, variable coding, structure of data files, and everything else you struggled with in this problem set. But tell also what is done well.**

Answer:

**Report how much time (hours) did you spend on this problem set. This will help me understand individual workload and challenges with this material.**

Answer: It took me about 5 to 6 hours to complete this problem set. The most challenging questions were 1.3.5 and 1.2.2.